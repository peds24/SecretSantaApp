generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model FamilyGroup {
  id          String       @id @default(cuid())
  name        String
  slug        String       @unique   // used in the URL, e.g. "smith-family-2025"
  members     Member[]
  assignments Assignment[]
  createdAt   DateTime     @default(now())
}

model Member {
  id                  String        @id @default(cuid())
  name                String
  email               String?       @unique
  familyGroupId       String
  familyGroup         FamilyGroup   @relation(fields: [familyGroupId], references: [id])
  givingAssignments   Assignment[]  @relation("GiverAssignments")
  receivingAssignments Assignment[] @relation("ReceiverAssignments")
  wishlist            Wishlist?
  createdAt           DateTime      @default(now())

  @@index([familyGroupId, name])
}

model Assignment {
  id           String      @id @default(cuid())
  familyGroupId String
  familyGroup  FamilyGroup @relation(fields: [familyGroupId], references: [id])

  giverId      String
  giver        Member      @relation("GiverAssignments", fields: [giverId], references: [id])

  receiverId   String
  receiver     Member      @relation("ReceiverAssignments", fields: [receiverId], references: [id])

  // In a group, a given member is the Secret Santa for exactly one receiver
  @@unique([familyGroupId, giverId])
}

model Wishlist {
  id        String   @id @default(cuid())
  memberId  String   @unique
  member    Member   @relation(fields: [memberId], references: [id])
  content   String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
